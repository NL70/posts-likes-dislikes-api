let posts=[];const form=document.getElementById("login-form"),username=document.getElementById("username"),password=document.getElementById("password");let usernameValue="";const usernameDisplay=document.getElementById("username-display"),apiUrl="https://posts-likes-dislikes-api.herokuapp.com/",title=document.getElementById("title"),content=document.getElementById("content"),createForm=document.getElementById("create-form"),login=async a=>{const b=await fetch(`${apiUrl}login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(201===b.status){const a=await b.json();localStorage.setItem("username",a.data.username),window.location.href="/"}};usernameDisplay&&(usernameDisplay.innerText=localStorage.getItem("username"));const handleSubmit=async a=>{a.preventDefault(),await login({username:username.value,password:password.value})},handleCreatePost=async a=>{a.preventDefault(),await createPost({title:title.value,content:content.value}),window.location.href="/"},createPost=async a=>{await fetch(`${apiUrl}posts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})};form&&form.addEventListener("submit",handleSubmit),createForm&&createForm.addEventListener("submit",handleCreatePost);const fetchPosts=async()=>{const a=await fetch(`${apiUrl}posts`),b=await a.json();posts=b.data},showPosts=async()=>{await fetchPosts();const a=document.getElementById("cards-wrapper");a&&posts.forEach(b=>{const c=document.createElement("div");c.classList.add("card");const d=document.createElement("h2");d.classList.add("heading");const e=document.createElement("p");e.classList.add("content");const f=document.createElement("div");f.classList.add("likes-dislikes");const g=document.createElement("div");g.classList.add("likes-dislikes-individual");let h=document.createElement("span");h.innerText="\u2191";const i=document.createElement("p");i.classList.add("content"),i.classList.add("likes-count");const j=document.createElement("div");j.classList.add("likes-dislikes-individual");let k=document.createElement("span");k.innerText="\u2193";let l=document.createElement("img");l.src="images/delete-button.png",l.classList.add("content"),l.classList.add("delete-button");const m=document.createElement("p");m.classList.add("content");const n=document.createElement("div");n.classList.add("left-container");const o=document.createElement("div");d.innerText=b.title,e.innerText=b.content,i.innerText=b.like_count,m.innerText=b.dislike_count,j.addEventListener("click",async()=>{b.is_disliked?debounce(async()=>{await deleteDislikes(b,m,b.id),b.is_disliked=!1,b.dislike_count-=1})():debounce(async()=>{await addDislikes(b,m,b.id),b.is_disliked=!0,b.dislike_count+=1})()}),g.addEventListener("click",async()=>{b.is_liked?debounce(async()=>{await deleteLikes(b,i,b.id),b.is_liked=!1,b.like_count-=1})():debounce(async()=>{await addLikes(b,i,b.id),b.is_liked=!0,b.like_count+=1})()}),l.addEventListener("click",async()=>{await deletePosts(b,b.id),c.remove()}),g.appendChild(h),g.appendChild(i),j.appendChild(k),j.appendChild(m),f.appendChild(g),f.appendChild(j),o.appendChild(l),n.appendChild(d),n.appendChild(e),n.appendChild(f),c.appendChild(n),c.appendChild(o),a.appendChild(c)})};showPosts();const addLikes=async(a,b,c)=>{const d=await fetch(`${apiUrl}posts/${c}/likes`,{method:"POST",headers:{"Content-Type":"application/json"}});200===d.status&&(b.innerText=parseInt(a.like_count)+1)},deleteLikes=async(a,b,c)=>{const d=await fetch(`${apiUrl}posts/${c}/likes`,{method:"DELETE",headers:{"Content-Type":"application/json"}});204===d.status&&(b.innerText=parseInt(a.like_count)-1)},addDislikes=async(a,b,c)=>{const d=await fetch(`${apiUrl}posts/${c}/dislikes`,{method:"POST",headers:{"Content-Type":"application/json"}});200===d.status&&(b.innerText=parseInt(a.dislike_count)+1)},deleteDislikes=async(a,b,c)=>{const d=await fetch(`${apiUrl}posts/${c}/dislikes`,{method:"DELETE",headers:{"Content-Type":"application/json"}});204===d.status&&(b.innerText=parseInt(a.dislike_count)-1)},deletePosts=async(a,b)=>{await fetch(`${apiUrl}posts/${b}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})};function debounce(a,b=300){let c;return(...d)=>{c||a.apply(this,d),clearTimeout(c),c=setTimeout(()=>{c=void 0},b)}}